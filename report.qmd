---
title: "The Measles Project"
subtitle: "Comparing Private & Public Schools"
format: html
editor: visual
execute:
  echo: true
---

```{r}
#| label: load-pkgs
#| message: false

library(tidyverse)
library(leaflet)

```

## Introduction and Data

**Research question:** In 2018, how does the vaccination rate for measles differ across regions in the US? How do school districts in regions with high vaccination rates vs. low vaccination rates differ (public v. private, enrollment rate, type of geographical region - urban, rural)?

**Hypothesis:** It is expected that states with higher rates of urbanization will have higher vaccination rates for mmr. It is also expected that schools in these states will have higher vaccination rates, differing mainly on whether they are private or public (whereby private may have higher rates).

**Note:**

We saw negative values, but we don't know what it means - perhaps these suggest that the schools did/do not report vaccination rates.

Full disclosure: In the first visualization, there are some data points in Asia, suggesting that some of the schools are located in Asia, but we are working on removing these. Also, for now the first visualization has "eval: FALSE" to facilitate pushing and pulling on GitHub (leaflet takes up a lot of space).

**Motivation and Context**

The motivation for this project stemmed from the measles dataset from tidytuesday. It was interesting to see how the data set categorically characterized the data. Our team imported the data into R and used the categories as a guide to make our plots and questions. The data as reported in the Wall Street Journal presents a map of measles vaccination rates in schools across the United States, showing that some schools have dangerously low vaccination rates, which increases the risk of measles outbreaks. The data is based on information from the 2018-2019 school year and includes public, private, and charter schools. According to the map, many of the schools with the lowest vaccination rates are in states such as Idaho, Utah, Colorado, and Oregon. The article also notes that measles cases have been on the rise in recent years, and emphasizes the importance of vaccination in preventing the spread of the highly contagious virus. Through this narrative and viewing the raw data we were able to form our hypothesis and question.

**Ethical Issues**

Vaccination data is listed under HIPAA as protected health information and therefore cannot be shared without patient consent. In certain areas, vaccine data is not required for schools as well. The data may also be used to discriminate against certain areas unjustly. The sample population does not all benefit equally from our research. Some areas may also be more or less receptive to revealing their vaccination information so the study may not impact our target population equally.

**Citing Sources**

\[1\] "Urban Percentage of the Population for States, Historical." Iowa State University \| Iowa Community Indicators Program, Iowa State University, www.icip.iastate.edu/tables/population/urban-pct-states.

## Methodology

visualizations and summary statistics

```{r}
#| label: data

measles <- readr::read_csv('data/measles.csv')

glimpse(measles)
```

```{r}
#| label: filtering_measles_dataset

measles <- measles |>
  filter(!is.na(lat)) |>
  filter(!is.na(lng)) 

```

```{r}
#| label: creating_measles_map

measles_map <- measles |>
  group_by(name, city, state, lat, lng) |>
  summarise(mmr = mmr) 

```

```{r}
#| label: US_map_per_county

mycolor <- colorNumeric(palette = 'RdBu', domain = c(-2:100), 
                        reverse = T)

```

```{r}
#| label: leaflet_map
#| eval: FALSE

measles_map |>
  leaflet() |>
  addProviderTiles('CartoDB') |>
  addCircleMarkers(radius = ~0.01*mmr, 
                   color = ~mycolor(mmr),
                   popup = ~paste0(name, "<br/>",
                                   mmr)) |>
  addLegend(pal = mycolor, 
            values = c(-2:100),
            opacity = 0.75,
            title = "Vax Rate per School",
            position = 'topleft')

```

Figure 1. Each data point represents a school, and the color represents the mmr vaccination rate at that school (reported) - where a dark blue would represent low vaccination rates (if any) and dark red would represent almost 100% (if not 100%) vaccination rates. This visualization will be used to 1) understand variability of vaccination rates in schools across different states, and 2) help us create valid connections between states that have substantially different mmr vaccination rates.

```{r}
#| label: filtering_measles

measles_filtered <- measles[measles$type %in% c("Public", "Private"), ]

mean_vaccination_rate <- aggregate(overall ~ type, measles_filtered, mean)


ggplot(mean_vaccination_rate, aes(x = type, y = overall, fill = type)) +
  geom_bar(stat = "identity") +
  labs(title = "Figure 2 Vaccination Rates by School Type", 
       x = "School Type", 
       y = "Mean Vaccination Rate") +
  theme_bw()

```

state highest vs. lowest (county x, county y)

```{r}
#| label: table_measles

measles |>
  filter(mmr != -1) |>
  group_by(state) |>
  summarise(max = max(mmr),
            min = min(mmr))
  
tablemeasles<- measles |>
  filter(mmr != -1) |>
  group_by(state) |>
  filter(mmr == max(mmr) | mmr == min(mmr)) |>
  summarise(county = county,
            mmr = mmr) |>
  arrange(mmr)

tablemeasles |>
  group_by(county, state) |>
  summarize(county = county,
             state = state,
             mmr = mmr) |>
  distinct()
  
```

```{r}
#| label: mean_mmr_per_state

library(dplyr)

measles_state <- measles |>
  filter(mmr > 0) |>
  group_by(state) 

```

```{r}
#| label: plot_measles_state

mean_measles_state <- measles_state |>
  summarise(mean_mmr = mean(mmr)) 

high_low_state_mean <- measles_state |>
  filter(state == c("Illinois", "Massachusetts", "Pennsylvania", "Arkansas", 
                    "Washington", "Minnesota"))

high_low_state_mean |>
  ggplot(
    aes(x = mmr, y = state)) +
  geom_boxplot() +
  labs(title = "States with Highest and Lowest Reported MMR Vaccination Rates", 
       x = "MMR Vaccination Rate (%)", 
       y = "State")

```

Figure 3. This plot represents the six states with the highest and lowest MMR vaccination rates from the total states sampled. The states with the lowest reported MMR vaccination rates is Arkansas, Washington, and Minnesota. The states with the highest reported MMR vaccination rates is Massachusetts, Illinois, and Pennsylvania.

*Inference*

For this hypothesis test, let: 
$\mu_priv$ = the true (population) mean amount of 
The truw (population) mean price per guest of airbnbs in NC 2020 is larger than $60


Null Hypothesis
$\H_o$:  

## Results

Figure 1 - This visualization answers the 1st research question by showing which states have a high percentage of mmr vaccination rates across different schools (such as Ohio), and states that have a low percentage (such as Florida). Though Ohio and Florida don't show much variability across different schools, California does show a lot of variability. Overall, this shows a general map of how mmr vaccination rates differ across different regions in the US.

Figure 2 - The graph showing the average vaccination rates between private and public schools seems to show a higher average vaccination rate for public schools. This is possibly due to local government rules and control over public schools in which students may be mandated to get vaccinated. Whereas in private schools it may have been more up to choice and out of government control.

<<<<<<< HEAD
Figure 3 - To explore if there is a relationship between urban and rural status and MMR vaccination rate, first, the states with the highest (Massachusetts, Illinois, and Pennsylvania) and lowest (Arkansas, Washington, and Minnesota) mean MMR vaccination rates were plotted. On its own this does not display any relation of urban or rural status to percentage of MMR vaccination rates, so information, provided by Iowa State University, on the 2010 U.S. Decenial Cenus was referenced \[1\]. The percentage of the total population in urban areas per each state was found: Massachusetts (92%), Illinois (88.5%), Pennsylvania (78.7%), Arkansas (56.2%), Washington (84.1%), and Minnesota (73.3%). There appears to be a weak correlation between urban/rural status of each state and MMR vaccination rate, but to a slight degree there is a trend. For instance, the state with the most drastic difference in mean MMR vaccination rate is Arkansas (80.49%) when compared to states with the highest mean MMR vaccination rates (\>95%). Relatedely, Arkansas also has a significantly lower percentage of the total population in urban areas. States like Massachusetts and Illinois hold comparably higher percentages of the total population in urban areas *and* hold the highest mean MMR vaccination rates, 97.04% & 97.39%, respectively. However, states like Washington weaken the correlation by having a high percentage of the total population in urban areas, but reporting a comparably low mean MMR vaccination rate (89.3%).

Full disclosure: In the first visualization, there are some data points in Asia, suggesting that some of the schools are located in Asia, but we are working on removing these. Also, for now the first visualization has "eval: FALSE" to facilitate pushing and pulling on GitHub (leaflet takes up a lot of space).
=======
Figure 3 - To explore if there is a relationship between urban and rural status and MMR vaccination rate, first, the states with the highest (Massachusetts, Illinois, and Pennsylvania) and lowest (Arkansas, Washington, and Minnesota) mean MMR vaccination rates were plotted. On its own this does not display any relation of urban or rural status to percentage of MMR vaccination rates, so information, provided by Iowa State University, on the 2010 U.S. Decenial Cenus was referenced [1]. The percentage of the total population in urban areas per each state was found: Massachusetts (92%), Illinois (88.5%), Pennsylvania (78.7%), Arkansas (56.2%), Washington (84.1%), and Minnesota (73.3%). There appears to be a weak correlation between urban/rural status of each state and MMR vaccination rate, but to a slight degree there is a trend. For instance, the state with the most drastic difference in mean MMR vaccination rate is Arkansas (80.49%) when compared to states with the highest mean MMR vaccination rates (\>95%). Relatedely, Arkansas also has a significantly lower percentage of the total population in urban areas. States like Massachusetts and Illinois hold comparably higher percentages of the total population in urban areas *and* hold the highest mean MMR vaccination rates, 97.04% & 97.39% respectively. However, states like Washington weaken the correlation by having a high percentage of the total population in urban areas, but reporting a comparably low mean MMR vaccination rate (89.3%).
>>>>>>> 290387aca1f766ff77fd199581f4b4e7ee212e03
